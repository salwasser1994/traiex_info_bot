import os
import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.client.bot import DefaultBotProperties
from aiogram.filters import Command
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

# –ë–µ—Ä—ë–º —Ç–æ–∫–µ–Ω –∏–∑ Environment Variables Render
TOKEN = os.getenv("API_Token")
if not TOKEN:
    raise ValueError("API_Token –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!")

bot = Bot(token=TOKEN, default=DefaultBotProperties(parse_mode="HTML"))
dp = Dispatcher()

# –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
def main_menu():
    keyboard = [
        [InlineKeyboardButton(text="üìä –û–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞", callback_data="overview")],
        [InlineKeyboardButton(text="üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç", callback_data="test")],
        [InlineKeyboardButton(text="üí∞ –ì–æ—Ç–æ–≤ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å", callback_data="invest")],
        [InlineKeyboardButton(text="üìÑ –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–≥–æ–≤–æ—Ä–∞ –æ—Ñ–µ—Ä—Ç—ã", callback_data="agreement")],
        [InlineKeyboardButton(text="ü§ñ –ß—Ç–æ —Ç–∞–∫–æ–µ –±–æ—Ç –Ω–∞ –ò–ò", callback_data="ai_bot")],
        [InlineKeyboardButton(text="‚ùì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã", callback_data="faq")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

# –ö–æ–º–∞–Ω–¥–∞ /start
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç–∏–∫–∏! –í—ã–±–∏—Ä–∞–π –Ω—É–∂–Ω—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é:", reply_markup=main_menu())

# –ö–æ–º–∞–Ω–¥–∞ /upload ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–∏–¥–µ–æ —Å–µ–±–µ –∏ –≤—ã–≤–æ–¥ file_id
@dp.message(Command("upload"))
async def upload_video(message: types.Message):
    video_path = "video1.mp4"
    if not os.path.exists(video_path):
        await message.answer("‚ùå –í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.")
        return
    sent_video = await message.answer_video(video=video_path, caption="–¢–µ—Å—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ")
    await message.answer(f"‚úÖ File ID —ç—Ç–æ–≥–æ –≤–∏–¥–µ–æ: {sent_video.video.file_id}")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫
@dp.callback_query()
async def callbacks(callback: types.CallbackQuery):
    if callback.data == "overview":
        # –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è file_id –∑–∞–º–µ–Ω–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –Ω–∞ –≤–∞—à file_id
        file_id = "–í–ê–®_FILE_ID_–ó–î–ï–°–¨"
        await callback.message.answer_video(
            video=file_id,
            caption="–í–æ—Ç –≤–∏–¥–µ–æ —Å –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω–æ–π üìä"
        )
    else:
        await callback.answer()  # –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏—è –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
