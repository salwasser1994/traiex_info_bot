import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.client.bot import DefaultBotProperties
from aiogram.filters import Command
from aiogram.types import (
    ReplyKeyboardMarkup, KeyboardButton,
    InlineKeyboardMarkup, InlineKeyboardButton
)

# Ð¢Ð¾ÐºÐµÐ½ Ð±Ð¾Ñ‚Ð°
TOKEN = "8473772441:AAHpXfxOxR-OL6e3GSfh4xvgiDdykQhgTus"

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð±Ð¾Ñ‚Ð°
bot = Bot(token=TOKEN, default=DefaultBotProperties(parse_mode="HTML"))
dp = Dispatcher()

# Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ FAQ
faq_data = {
    "Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð¾Ð¹?":
        "Ð”Ð°, Ð²ÑÐµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ñ‰Ð¸Ñ‰Ñ‘Ð½Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ, Ð²Ð°ÑˆÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð° Ð½Ð°Ð´Ñ‘Ð¶Ð½Ð¾ Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹.",

    "Ð§Ñ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚, ÐµÑÐ»Ð¸ Ñ Ð¿Ð¾Ñ‚ÐµÑ€ÑÑŽ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ñƒ?":
        "Ð’Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ñ‡ÐµÑ€ÐµÐ· e-mail Ð¸Ð»Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ â€” Ð²Ð°Ñˆ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚ Ð½Ðµ Ð¿Ñ€Ð¾Ð¿Ð°Ð´Ñ‘Ñ‚.",

    "ÐÑƒÐ¶Ð½Ð¾ Ð»Ð¸ Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ?":
        "ÐÐµÑ‚, Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð°Ñ. Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¸Ð·ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹ Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿Ñ€Ð¸Ð½ÑÑ‚ÑŒ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð¾ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑÑ….",

    "Ð•ÑÑ‚ÑŒ Ð»Ð¸ ÑÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ð¸?":
        "ÐÐµÑ‚, Ð²ÑÐµ ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ð¸ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ðµ Ð¸ Ð·Ð°Ñ€Ð°Ð½ÐµÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹. Ð’Ñ‹ Ð²ÑÐµÐ³Ð´Ð° Ð·Ð½Ð°ÐµÑ‚Ðµ, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¸ Ð·Ð° Ñ‡Ñ‚Ð¾ Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚Ðµ.",

    "ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð²Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð² Ð»ÑŽÐ±Ð¾Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚?":
        "Ð”Ð°, ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° Ð¿Ð¾ Ð²Ð°ÑˆÐµÐ¼Ñƒ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ, Ð±ÐµÐ· Â«Ð·Ð°Ð¼Ð¾Ñ€Ð¾Ð·ÐºÐ¸Â» Ð¸ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… ÑÑ€Ð¾ÐºÐ¾Ð².",

    "Ð ÐµÑÐ»Ð¸ Ñ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÑŽ Ð² Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸ÑÑ…?":
        "ÐÐµ ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾ ðŸ™‚ Ð’ÑÑ‘ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¾ Ñ‚Ð°Ðº, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð°Ð¶Ðµ Ð½Ð¾Ð²Ð¸Ñ‡Ð¾Ðº Ð¼Ð¾Ð³ Ñ€Ð°Ð·Ð¾Ð±Ñ€Ð°Ñ‚ÑŒÑÑ. Ð•ÑÑ‚ÑŒ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸, Ð²Ð¸Ð´ÐµÐ¾ÑƒÑ€Ð¾ÐºÐ¸ Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°.",

    "Ð§Ñ‚Ð¾, ÐµÑÐ»Ð¸ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð° Ð¿ÐµÑ€ÐµÑÑ‚Ð°Ð½ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ?":
        "ÐœÑ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ðµ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ñ‹. Ð”Ð°Ð¶Ðµ Ð² ÑÐ»ÑƒÑ‡Ð°Ðµ ÑÐ±Ð¾Ñ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ñƒ Ð²Ð°Ñ.",

    "ÐÑƒÐ¶Ð½Ð¾ Ð»Ð¸ Ñ‚Ñ€Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð¼Ð½Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸?":
        "ÐÐµÑ‚, Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑƒÐ´ÐµÐ»ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¼Ð¸Ð½ÑƒÑ‚ Ð² Ð´ÐµÐ½ÑŒ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐ²Ð¾Ð¸Ð¼ ÑÑ‡Ñ‘Ñ‚Ð¾Ð¼.",

    "Ð•ÑÑ‚ÑŒ Ð»Ð¸ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ð¸?":
        "ÐœÑ‹ Ð½Ðµ Ð¾Ð±ÐµÑ‰Ð°ÐµÐ¼ Â«Ð·Ð¾Ð»Ð¾Ñ‚Ñ‹Ñ… Ð³Ð¾Ñ€Â», Ð½Ð¾ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ, Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ Ð¸ Ñ‡ÐµÑÑ‚Ð½ÑƒÑŽ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹."
}

# Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ (ReplyKeyboard)
def main_menu():
    keyboard = [
        [KeyboardButton(text="ðŸ“Š ÐžÐ±Ñ‰Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½Ð°"), KeyboardButton(text="ðŸ“ ÐŸÑ€Ð¾Ð¹Ñ‚Ð¸ Ñ‚ÐµÑÑ‚")],
        [KeyboardButton(text="ðŸ’° Ð“Ð¾Ñ‚Ð¾Ð² Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"), KeyboardButton(text="ðŸ“„ ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð° Ð¾Ñ„ÐµÑ€Ñ‚Ñ‹")],
        [KeyboardButton(text="âœ¨ ÐÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ Ñ€Ñ‹Ñ‡Ð°Ð³Ð°Ð¼")],
        [KeyboardButton(text="Ð§Ð°ÑÑ‚Ð¾ Ð·Ð°Ð´Ð°Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹â“")]
    ]
    return ReplyKeyboardMarkup(keyboard=keyboard, resize_keyboard=True)

# ÐœÐµÐ½ÑŽ FAQ
def faq_menu():
    keyboard = [[KeyboardButton(text=q)] for q in faq_data.keys()]
    keyboard.append([KeyboardButton(text="ðŸ”™ ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ")])
    return ReplyKeyboardMarkup(keyboard=keyboard, resize_keyboard=True)

# Inline-ÐºÐ½Ð¾Ð¿ÐºÐ° "Ð’ Ð¼ÐµÐ½ÑŽ"
def inline_back_to_menu():
    keyboard = [
        [InlineKeyboardButton(text="Ð’ Ð¼ÐµÐ½ÑŽ", callback_data="back_to_menu")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

# ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /start
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    file_id = "BAACAgQAAxkDAAIEgGi5kTsunsNKCxSgT62lGkOro6iLAAI8KgACIJ7QUfgrP_Y9_DJKNgQ"
    await message.answer_video(
        video=file_id,
        reply_markup=inline_back_to_menu()
    )

# ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ "Ð’ Ð¼ÐµÐ½ÑŽ"
@dp.callback_query()
async def callbacks(callback: types.CallbackQuery):
    if callback.data == "back_to_menu":
        await callback.message.answer("Ð¡Ð´ÐµÐ»Ð°Ð¹ ÑÐ²Ð¾Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€", reply_markup=main_menu())
        await callback.answer()

# Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð°
user_test_state = {}  # Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð½Ð¾Ð¼ÐµÑ€ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ° Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ user_id

# Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
test_questions = [
    {
        "question": "1. Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Ð˜ÑÐºÑƒÑÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð˜Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚ (Ð˜Ð˜) Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ðµ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¹?",
        "answers": ["Ð) Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚, ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð³Ñ€Ð¾Ð¼Ð½Ñ‹Ðµ Ð¾Ð±ÑŠÐµÐ¼Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð²Ñ‹ÑÐ²Ð»ÑÑ‚ÑŒ Ð·Ð°ÐºÐ¾Ð½Ð¾Ð¼ÐµÑ€Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ð±Ð¾Ð»ÐµÐµ Ð¾Ð±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ.",
                    "B) ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÐºÑÐ¿ÐµÑ€Ñ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ Ð¸ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ Ð±ÐµÐ· ÑƒÑÐ¸Ð»Ð¸Ð¹ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ Ð¸Ð½Ð²ÐµÑÑ‚Ð¾Ñ€Ð°."],
        "correct": 0
    },
    {
        "question": "2. ÐšÐ°Ðº Ð˜Ð˜ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ð² Ð°Ð½Ð°Ð»Ð¸Ð·Ðµ Ñ€Ñ‹Ð½ÐºÐ°?",
        "answers": ["Ð) Ð˜Ð˜ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹ÑÑ‚Ñ€Ð¾ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð½Ð¾Ð²Ð¾ÑÑ‚ÑÑ…, Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ñ… Ð¾Ñ‚Ñ‡ÐµÑ‚Ð°Ñ… Ð¸ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ñ‹ÑÐ²Ð¸Ñ‚ÑŒ Ñ‚Ñ€ÐµÐ½Ð´Ñ‹ Ð¸ Ð¾Ñ†ÐµÐ½Ð¸Ñ‚ÑŒ Ñ€Ð¸ÑÐºÐ¸.",
                    "B) Ð˜Ð˜ ÑÐ¿Ð¾ÑÐ¾Ð±ÐµÐ½ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¸Ð¹ Ð¾Ð¿Ñ‹Ñ‚ Ð¸ Ð¸Ð½Ñ‚ÑƒÐ¸Ñ†Ð¸ÑŽ, Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ Ð²ÑÐµ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð·Ð° Ð¸Ð½Ð²ÐµÑÑ‚Ð¾Ñ€Ð°."],
        "correct": 0
    },
    {
        "question": "3. ÐšÐ°ÐºÑƒÑŽ Ñ€Ð¾Ð»ÑŒ Ð¸Ð³Ñ€Ð°ÐµÑ‚ Ð˜Ð˜ Ð² Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð»Ð¸?",
        "answers": ["A) Ð˜Ð˜ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ ÑƒÑÑ‚Ñ€Ð°Ð½ÑÐµÑ‚ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð² Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¾Ð¼ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ðµ, Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ.",
                    "B) Ð˜Ð˜ Ð¼Ð¾Ð¶ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ñ… ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹, Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð½Ð° Ð·Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ñ…, Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°Ñ Ð±Ð¾Ð»ÐµÐµ Ð±Ñ‹ÑÑ‚Ñ€ÑƒÑŽ Ð¸ Ñ‚Ð¾Ñ‡Ð½ÑƒÑŽ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð»ÑŽ."],
        "correct": 1
    },
    {
        "question": "4. ÐšÐ°ÐºÑƒÑŽ Ð¸Ð· ÑÑ‚Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡ Ð˜Ð˜ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ Ð² ÑÑ„ÐµÑ€Ðµ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¹?",
        "answers": ["Ð) Ð’Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð¼Ð¾ÑˆÐµÐ½Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… ÑÑ…ÐµÐ¼ Ð¸ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ Ð¾ Ð¿Ð¾Ñ‚ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ñ€Ð¸ÑÐºÐ°Ñ….",
                    "B) ÐžÐ±ÐµÑÐ¿ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ð¸ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»Ð¸, Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ð¾Ñ‚ Ñ€Ñ‹Ð½Ð¾Ñ‡Ð½Ð¾Ð¹ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸Ð¸."],
        "correct": 0
    },
    {
        "question": "5. Ð§Ñ‚Ð¾ ÑÐ²Ð»ÑÐµÑ‚ÑÑ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ð¾Ð¼ Ð¿Ñ€Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð˜Ð˜ Ð² Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸ÑÑ…?",
        "answers": ["A) ÐŸÐ¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒÑÑ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð°Ð¼ Ð¸ Ð½Ðµ Ð²Ð¼ÐµÑˆÐ¸Ð²Ð°Ñ‚ÑŒÑÑ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑ.",
                    "B) ÐŸÐ¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ð¹ Ð˜Ð˜, Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð¸ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð¸ Ð¾Ð¿Ñ‹Ñ‚Ð°."],
        "correct": 1
    },
    {
        "question": "6. ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ñ€Ð°ÑÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ñ‚ÑŒ Ð˜Ð˜ ÐºÐ°Ðº 'Ñ€Ñ‹Ñ‡Ð°Ð³' Ð² Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸ÑÑ…?",
        "answers": ["Ð) Ð”Ð°, Ð˜Ð˜ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÑÐ¸Ð»Ð¸Ñ‚ÑŒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð¸Ð½Ð²ÐµÑÑ‚Ð¾Ñ€Ð°, Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑ ÐµÐ¼Ñƒ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½ÐµÐµ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ñ€Ð¸ÑÐºÐ°Ð¼Ð¸.",
                    "B) ÐÐµÑ‚, Ð˜Ð˜ - ÑÑ‚Ð¾ Ð»Ð¸ÑˆÑŒ ÑÐ»Ð¾Ð¶Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°, Ð½Ðµ Ð¸Ð¼ÐµÑŽÑ‰Ð°Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð²Ð»Ð¸ÑÐ½Ð¸Ñ Ð½Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¹."],
        "correct": 0
    }
]

# ÐœÐµÐ½ÑŽ Ð´Ð»Ñ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¹ Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ‚ÐµÑÑ‚" Ð¸ "ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ"
def start_test_menu():
    keyboard = [
        [KeyboardButton(text="ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ‚ÐµÑÑ‚")],
        [KeyboardButton(text="ðŸ”™ ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ")]
    ]
    return ReplyKeyboardMarkup(keyboard=keyboard, resize_keyboard=True)

# ÐœÐµÐ½ÑŽ Ð´Ð»Ñ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ "ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ"
def question_menu(answers):
    keyboard = [[KeyboardButton(text=a)] for a in answers]
    keyboard.append([KeyboardButton(text="ðŸ”™ ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ")])
    return ReplyKeyboardMarkup(keyboard=keyboard, resize_keyboard=True)

# ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹ Ð¼ÐµÐ½ÑŽ (ReplyKeyboard)
@dp.message()
async def handle_message(message: types.Message):
    user_id = message.from_user.id

    # ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°
    if message.text == "ðŸ“„ ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð° Ð¾Ñ„ÐµÑ€Ñ‚Ñ‹":
        file_id = "BQACAgQAAxkBAAIFOGi6vNHLzH9IyJt0q7_V4y73FcdrAAKXGwACeDjZUSdnK1dqaQoPNgQ"
        await message.answer_document(file_id)

    # Ð˜Ð½Ð²ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
    elif message.text == "ðŸ’° Ð“Ð¾Ñ‚Ð¾Ð² Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ":
        await message.answer("https://traiex.gitbook.io/user-guides/ru/kak-zaregistrirovatsya-na-traiex")

    # FAQ
    elif message.text == "Ð§Ð°ÑÑ‚Ð¾ Ð·Ð°Ð´Ð°Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹â“":
        await message.answer("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰Ð¸Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ:", reply_markup=faq_menu())
    
    elif message.text in faq_data:
        await message.answer(faq_data[message.text], reply_markup=faq_menu())

    # Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð°
    elif message.text == "âœ¨ ÐÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ Ñ€Ñ‹Ñ‡Ð°Ð³Ð°Ð¼":
        user_test_state[user_id] = -1  # ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸
        instruction_text = (
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ: Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð´Ð¸Ð½ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð½Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ.\n"
            "ÐŸÐ¾Ð¼Ð½Ð¸Ñ‚Ðµ, Ð˜Ð˜ - ÑÑ‚Ð¾ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚, Ð° Ð½Ðµ Ð²Ð¾Ð»ÑˆÐµÐ±Ð½Ð°Ñ Ð¿Ð°Ð»Ð¾Ñ‡ÐºÐ°."
        )
        await message.answer(instruction_text, reply_markup=start_test_menu())

    elif message.text == "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ‚ÐµÑÑ‚":
        user_test_state[user_id] = 0
        q = test_questions[0]
        await message.answer(q["question"], reply_markup=question_menu(q["answers"]))

    # ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹
    elif user_id in user_test_state and user_test_state[user_id] >= 0:
        current = user_test_state[user_id]
        q = test_questions[current]
        if message.text == q["answers"][q["correct"]]:
            next_index = current + 1
            if next_index < len(test_questions):
                user_test_state[user_id] = next_index
                next_q = test_questions[next_index]
                await message.answer(next_q["question"], reply_markup=question_menu(next_q["answers"]))
            else:
                user_test_state.pop(user_id)
                await message.answer("Ð¢ÐµÑÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½! Ð’Ñ‹ Ð²ÐµÑ€Ð½ÑƒÐ»Ð¸ÑÑŒ Ð² Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ ðŸ‘‡", reply_markup=main_menu())
        # ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ â€” Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°ÐµÐ¼
        return

    # ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ
    elif message.text == "ðŸ”™ ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ":
       
